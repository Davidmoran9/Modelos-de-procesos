<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estudiantes - Consulta de Horarios e Inscripción</title>
    <link rel="stylesheet" href="estiloE.css">

</head>
<body>
    <header>
        <h1>Portal del Estudiante</h1>
    </header>
    <nav>
        <ul>
            <li><a href="index.html">Dashboard</a></li>
            <li><a href="profesores.html">Profesores</a></li>
            <li><a href="horarios.html">Horarios</a></li>
            <li><a href="cursos.html">Cursos</a></li>
            <li><a href="../index.html">Salir</a></li>

        </ul>
    </nav>
    <main>
        <div class="form-group">
            <label for="seleccionarHorario">Seleccionar Tipo de Horario:</label>
            <select id="seleccionarHorario">
                <option value="">Elige un tipo de horario...</option>
                <option value="semana">Entre Semana (Lunes, Miércoles, Viernes)</option>
                <option value="sabado">Sábado Intensivo</option>
            </select>
        </div>
        <div class="form-group">
            <label>Seleccionar Curso:</label>
            <div class="course-container">
                <div class="course-selection" data-curso="Fotografía">
                    <img src="icons/fotografia.png" alt="Fotografía" class="course-icon">
                    <span>Fotografía</span>
                </div>
                <div class="course-selection" data-curso="Arte">
                    <img src="icons/arte.png" alt="Arte" class="course-icon">
                    <span>Arte</span>
                </div>
                <div class="course-selection" data-curso="Canto">
                    <img src="icons/canto.png" alt="Canto" class="course-icon">
                    <span>Canto</span>
                </div>
                <div class="course-selection" data-curso="Música">
                    <img src="icons/musica.png" alt="Música" class="course-icon">
                    <span>Música</span>
                </div>
                <div class="course-selection" data-curso="Escultura">
                    <img src="icons/escultura.png" alt="Escultura" class="course-icon">
                    <span>Escultura</span>
                </div>
            </div>
        </div>
        <button id="registrarEstudiante">Registrar</button>
        
        <h2>Horarios Disponibles</h2>
        <div class="card-container" id="cardContainer"></div>

        <h2>Horarios Inscritos</h2>
        <div class="card-container" id="cardInscritos"></div>
        <button id="borrarRegistros">Borrar Horarios Inscritos</button>
        <button id="imprimirRegistros">Imprimir Registros</button>
        <!-- Enlace oculto para la descarga de la foto QR.jpg -->
        <a id="descargarFoto" href="QR.jpg" download style="display: none;"></a>
    </main>
    <footer>
        <p>&copy; 2023 Portal del Estudiante de Modelos de Procesos</p>
    </footer>

    <script>
        let selectedCourse = '';

        document.querySelectorAll('.course-selection').forEach(course => {
            course.addEventListener('click', function() {
                document.querySelectorAll('.course-selection').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedCourse = this.getAttribute('data-curso');
            });
        });

        function cargarHorarios() {
            const horarios = JSON.parse(localStorage.getItem('horarios')) || [];
            const cardContainer = document.getElementById('cardContainer');

            cardContainer.innerHTML = '';

            horarios.forEach(horario => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.innerHTML = `
                    <h3>${horario.dia} - ${horario.hora}</h3>
                    <p>Curso: ${horario.curso}</p>
                    <p style="color: transparent;">Profesor: ${horario.profesor}</p>
                    <p>Cupos: ${horario.cupos}</p>
                `;
                cardContainer.appendChild(card);
            });
        }

        function cargarHorariosInscritos() {
            const registros = JSON.parse(localStorage.getItem('registros')) || [];
            const cardInscritos = document.getElementById('cardInscritos');

            cardInscritos.innerHTML = '';

            registros.forEach(registro => {
                const card = document.createElement('div');
                card.classList.add('card');
                let dias = '';
                if (registro.horario === 'Entre Semana') {
                    dias = 'Lunes, Miércoles, Viernes';
                } else {
                    dias = 'Sábado';
                }
                card.innerHTML = `
                    <h3>${dias}</h3>
                    <p>Curso: ${registro.curso}</p>
                `;
                cardInscritos.appendChild(card);
            });
        }

        function registrarEstudiante() {
    const tipoHorario = document.getElementById('seleccionarHorario').value;

    if (tipoHorario === '' || selectedCourse === '') {
        alert('Por favor, completa todos los campos.');
        return;
    }

    const horarios = JSON.parse(localStorage.getItem('horarios')) || [];
    let cuposDisponibles = false;

    // Filtrar los horarios según el tipo de horario y curso seleccionado
    const horariosSeleccionados = horarios.filter(horario => 
        (tipoHorario === 'sabado' && horario.dia === 'Sábado' && horario.curso === selectedCourse) ||
        (tipoHorario === 'semana' && horario.dia !== 'Sábado' && horario.curso === selectedCourse)
    );

    // Verificar los cupos disponibles para los horarios seleccionados
    horariosSeleccionados.forEach(horario => {
        if (horario.cupos > 0) {
            cuposDisponibles = true;
            horario.cupos--;  // Reducir el cupo disponible
        }
    });

    // Si no hay cupos disponibles, mostrar un mensaje
    if (!cuposDisponibles) {
        alert('No hay cupos disponibles para el curso seleccionado en el horario elegido.');
        return;
    }

    // Actualizar el localStorage con los nuevos cupos después de la inscripción
    localStorage.setItem('horarios', JSON.stringify(horarios));

    // Agregar el registro a los horarios inscritos
    const registros = JSON.parse(localStorage.getItem('registros')) || [];
    registros.push({
        horario: tipoHorario === 'sabado' ? 'Sábado Intensivo' : 'Entre Semana',
        curso: selectedCourse
    });
    localStorage.setItem('registros', JSON.stringify(registros));

    alert('Registro exitoso.');
    cargarHorariosInscritos(); // Actualizar la lista de horarios inscritos
    cargarHorarios(); // Actualizar la lista de horarios disponibles con los cupos actualizados
}



        document.getElementById('registrarEstudiante').addEventListener('click', registrarEstudiante);
        document.getElementById('imprimirRegistros').addEventListener('click', function() {
            const registros = JSON.parse(localStorage.getItem('registros')) || [];
            console.log(registros);
            document.getElementById('descargarFoto').click();
        });

        document.getElementById('borrarRegistros').addEventListener('click', function() {
            const registros = JSON.parse(localStorage.getItem('registros')) || [];
            const horarios = JSON.parse(localStorage.getItem('horarios')) || [];

            // Restaurar los cupos de los horarios
            registros.forEach(registro => {
                horarios.forEach(horario => {
                    if (horario.curso === registro.curso) {
                        horario.cupos++; // Restablece el cupo
                    }
                });
            });

            // Borrar los registros
            localStorage.removeItem('registros');
            localStorage.setItem('horarios', JSON.stringify(horarios));

            cargarHorarios(); // Actualiza los horarios disponibles
            cargarHorariosInscritos(); // Actualiza la lista de horarios inscritos (vacía ahora)
        });

        cargarHorarios();
        cargarHorariosInscritos();
    </script>
</body>
</html>
